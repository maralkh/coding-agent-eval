{
  "id": "scikit-learn__scikit-learn-31181",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "5d4ba49a28f6e7d90656b74cd77ff2d8c57185e3",
  "issue_number": 1234,
  "issue_title": "MRG fix bincount mess I made in kmeans.",
  "issue_body": "This should clean up the stuff I pushed earlier.\ncc @ogrisel @gaelvaroquaux Could you have a brief look? What I pushed earlier is buggy but I didn't dare push again after so many failed fixes.\n",
  "pr_number": 31181,
  "pr_title": "TST Use global_random_seed in sklearn/datasets/tests/test_samples_generator.py",
  "gold_patch": "diff --git a/sklearn/datasets/tests/test_samples_generator.py b/sklearn/datasets/tests/test_samples_generator.py\nindex 5f1fddee0dacd..c1a7cca3141ad 100644\n--- a/sklearn/datasets/tests/test_samples_generator.py\n+++ b/sklearn/datasets/tests/test_samples_generator.py\n@@ -344,20 +344,20 @@ def test_make_hastie_10_2():\n     assert np.unique(y).shape == (2,), \"Unexpected number of classes\"\n \n \n-def test_make_regression():\n+def test_make_regression(global_random_seed):\n     X, y, c = make_regression(\n-        n_samples=100,\n+        n_samples=200,\n         n_features=10,\n         n_informative=3,\n         effective_rank=5,\n         coef=True,\n         bias=0.0,\n         noise=1.0,\n-        random_state=0,\n+        random_state=global_random_seed,\n     )\n \n-    assert X.shape == (100, 10), \"X shape mismatch\"\n-    assert y.shape == (100,), \"y shape mismatch\"\n+    assert X.shape == (200, 10), \"X shape mismatch\"\n+    assert y.shape == (200,), \"y shape mismatch\"\n     assert c.shape == (10,), \"coef shape mismatch\"\n     assert sum(c != 0.0) == 3, \"Unexpected number of informative features\"\n \n@@ -369,7 +369,7 @@ def test_make_regression():\n     assert X.shape == (100, 1)\n \n \n-def test_make_regression_multitarget():\n+def test_make_regression_multitarget(global_random_seed):\n     X, y, c = make_regression(\n         n_samples=100,\n         n_features=10,\n@@ -377,7 +377,7 @@ def test_make_regression_multitarget():\n         n_targets=3,\n         coef=True,\n         noise=1.0,\n-        random_state=0,\n+        random_state=global_random_seed,\n     )\n \n     assert X.shape == (100, 10), \"X shape mismatch\"\n@@ -389,11 +389,11 @@ def test_make_regression_multitarget():\n     assert_almost_equal(np.std(y - np.dot(X, c)), 1.0, decimal=1)\n \n \n-def test_make_blobs():\n+def test_make_blobs(global_random_seed):\n     cluster_stds = np.array([0.05, 0.2, 0.4])\n     cluster_centers = np.array([[0.0, 0.0], [1.0, 1.0], [0.0, 1.0]])\n     X, y = make_blobs(\n-        random_state=0,\n+        random_state=global_random_seed,\n         n_samples=50,\n         n_features=2,\n         centers=cluster_centers,\n@@ -417,12 +417,15 @@ def test_make_blobs_n_samples_list():\n     ), \"Incorrect number of samples per blob\"\n \n \n-def test_make_blobs_n_samples_list_with_centers():\n+def test_make_blobs_n_samples_list_with_centers(global_random_seed):\n     n_samples = [20, 20, 20]\n     centers = np.array([[0.0, 0.0], [1.0, 1.0], [0.0, 1.0]])\n     cluster_stds = np.array([0.05, 0.2, 0.4])\n     X, y = make_blobs(\n-        n_samples=n_samples, centers=centers, cluster_std=cluster_stds, random_state=0\n+        n_samples=n_samples,\n+        centers=centers,\n+        cluster_std=cluster_stds,\n+        random_state=global_random_seed,\n     )\n \n     assert X.shape == (sum(n_samples), 2), \"X shape mismatch\"\n@@ -479,8 +482,10 @@ def test_make_blobs_error():\n         make_blobs(n_samples, centers=3)\n \n \n-def test_make_friedman1():\n-    X, y = make_friedman1(n_samples=5, n_features=10, noise=0.0, random_state=0)\n+def test_make_friedman1(global_random_seed):\n+    X, y = make_friedman1(\n+        n_samples=5, n_features=10, noise=0.0, random_state=global_random_seed\n+    )\n \n     assert X.shape == (5, 10), \"X shape mismatch\"\n     assert y.shape == (5,), \"y shape mismatch\"\n@@ -494,8 +499,8 @@ def test_make_friedman1():\n     )\n \n \n-def test_make_friedman2():\n-    X, y = make_friedman2(n_samples=5, noise=0.0, random_state=0)\n+def test_make_friedman2(global_random_seed):\n+    X, y = make_friedman2(n_samples=5, noise=0.0, random_state=global_random_seed)\n \n     assert X.shape == (5, 4), \"X shape mismatch\"\n     assert y.shape == (5,), \"y shape mismatch\"\n@@ -505,8 +510,8 @@ def test_make_friedman2():\n     )\n \n \n-def test_make_friedman3():\n-    X, y = make_friedman3(n_samples=5, noise=0.0, random_state=0)\n+def test_make_friedman3(global_random_seed):\n+    X, y = make_friedman3(n_samples=5, noise=0.0, random_state=global_random_seed)\n \n     assert X.shape == (5, 4), \"X shape mismatch\"\n     assert y.shape == (5,), \"y shape mismatch\"\n@@ -533,13 +538,13 @@ def test_make_low_rank_matrix():\n     assert sum(s) - 5 < 0.1, \"X rank is not approximately 5\"\n \n \n-def test_make_sparse_coded_signal():\n+def test_make_sparse_coded_signal(global_random_seed):\n     Y, D, X = make_sparse_coded_signal(\n         n_samples=5,\n         n_components=8,\n         n_features=10,\n         n_nonzero_coefs=3,\n-        random_state=0,\n+        random_state=global_random_seed,\n     )\n     assert Y.shape == (5, 10), \"Y shape mismatch\"\n     assert D.shape == (8, 10), \"D shape mismatch\"\n@@ -557,8 +562,8 @@ def test_make_sparse_uncorrelated():\n     assert y.shape == (5,), \"y shape mismatch\"\n \n \n-def test_make_spd_matrix():\n-    X = make_spd_matrix(n_dim=5, random_state=0)\n+def test_make_spd_matrix(global_random_seed):\n+    X = make_spd_matrix(n_dim=5, random_state=global_random_seed)\n \n     assert X.shape == (5, 5), \"X shape mismatch\"\n     assert_array_almost_equal(X, X.T)\n@@ -604,8 +609,10 @@ def test_make_sparse_spd_matrix(norm_diag, sparse_format, global_random_seed):\n \n \n @pytest.mark.parametrize(\"hole\", [False, True])\n-def test_make_swiss_roll(hole):\n-    X, t = make_swiss_roll(n_samples=5, noise=0.0, random_state=0, hole=hole)\n+def test_make_swiss_roll(global_random_seed, hole):\n+    X, t = make_swiss_roll(\n+        n_samples=5, noise=0.0, random_state=global_random_seed, hole=hole\n+    )\n \n     assert X.shape == (5, 3)\n     assert t.shape == (5,)\n@@ -613,8 +620,8 @@ def test_make_swiss_roll(hole):\n     assert_array_almost_equal(X[:, 2], t * np.sin(t))\n \n \n-def test_make_s_curve():\n-    X, t = make_s_curve(n_samples=5, noise=0.0, random_state=0)\n+def test_make_s_curve(global_random_seed):\n+    X, t = make_s_curve(n_samples=5, noise=0.0, random_state=global_random_seed)\n \n     assert X.shape == (5, 3), \"X shape mismatch\"\n     assert t.shape == (5,), \"t shape mismatch\"\n@@ -669,8 +676,8 @@ def test_make_checkerboard():\n     assert_array_almost_equal(X1, X2)\n \n \n-def test_make_moons():\n-    X, y = make_moons(3, shuffle=False)\n+def test_make_moons(global_random_seed):\n+    X, y = make_moons(3, shuffle=False, random_state=global_random_seed)\n     for x, label in zip(X, y):\n         center = [0.0, 0.0] if label == 0 else [1.0, 0.5]\n         dist_sqr = ((x - center) ** 2).sum()\n",
  "fail_to_pass": [
    "test_make_regression",
    "test_make_regression_multitarget",
    "test_make_blobs",
    "test_make_blobs_n_samples_list_with_centers",
    "test_make_friedman1",
    "test_make_friedman2",
    "test_make_friedman3",
    "test_make_sparse_coded_signal",
    "test_make_spd_matrix",
    "test_make_swiss_roll",
    "test_make_s_curve",
    "test_make_moons"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/datasets/tests/test_samples_generator.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-04-11T12:30:15Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/31181",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/1234"
}