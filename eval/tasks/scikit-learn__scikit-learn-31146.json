{
  "id": "scikit-learn__scikit-learn-31146",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "0b6883610424923222a512a37076c4c1f9741da5",
  "issue_number": 31077,
  "issue_title": "Partial dependence broken when categorical_features has an empty list",
  "issue_body": "### Describe the bug\n\nWhen we pass an empty list to **categorical_features**, **partial_dependence** will raise an error ValueError: Expected **categorical_features** to be an array-like of boolean, integer, or string. Got float64 instead.\n\n### Steps/Code to Reproduce\n\n```python\nfrom sklearn import datasets\nimport pandas as pd\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.inspection import partial_dependence\n\niris, Species = datasets.load_iris(return_X_y=True)\niris = pd.DataFrame(\niris,\ncolumns=[\"sepal_length\", \"sepal_width\", \"petal_length\", \"petal_width\"]\n)\niris[\"species\"] = pd.Series(Species).map({0: \"A\", 1: \"B\", 2: \"C\"})\niris.head()\n\nspecies_encoder = make_pipeline(\nSimpleImputer(strategy=\"constant\", fill_value=\"A\"),\nOneHotEncoder(drop=[\"A\"], sparse_output=False)\n)\n\npreprocessor = ColumnTransformer(\ntransformers=[\n(\"species_encoder\", species_encoder, [\"species\"]),\n(\"other\", SimpleImputer(), [\"sepal_width\", \"petal_width\", \"petal_length\"])\n],\nverbose_feature_names_out=False\n).set_output(transform=\"pandas\")\n\nmodel = make_pipeline(preprocessor, LinearRegression())\n\nmodel.fit(iris, iris.sepal_length)\n\npd = partial_dependence(estimator=model, X= iris, features= [\"sepal_length\"], categorical_features= [])\n```\n\n### Expected Results\n\n.\n\n### Actual Results\n\n```pytb\nValueError Traceback (most recent call last)\nCell In[12], line 28\n24 model = make_pipeline(preprocessor, LinearRegression())\n26 model.fit(iris, iris.sepal_length)\n---> 28 pd = partial_dependence(estimator=model, X= iris, features= [\"sepal_length\"], categorical_features= [])\n\nFile ~.venv/lib/python3.10/site-packages/sklearn/utils/_param_validation.py:213, in validate_params..decorator..wrapper(*args, **kwargs)\n207 try:\n208 with config_context(\n209 skip_parameter_validation=(\n210 prefer_skip_nested_validation or global_skip_validation\n211 )\n212 ):\n--> 213 return func(*args, **kwargs)\n214 except InvalidParameterError as e:\n215 # When the function is just a wrapper around an estimator, we allow\n216 # the function to delegate validation to the estimator, but we replace\n217 # the name of the estimator by the name of the function in the error\n218 # message to avoid confusion.\n219 msg = re.sub(\n220 r\"parameter of \\w+ must be\",\n221 f\"parameter of {func.qualname} must be\",\n222 str(e),\n223 )\n\nFile ~.venv/lib/python3.10/site-packages/sklearn/inspection/_partial_dependence.py:679, in partial_dependence(estimator, X, features, sample_weight, categorical_features, feature_names, response_method, percentiles, grid_resolution, method, kind)\n675 is_categorical = [\n676 idx in categorical_features_idx for idx in features_indices\n677 ]\n678 else:\n--> 679 raise ValueError(\n680 \"Expected categorical_features to be an array-like of boolean,\"\n681 f\" integer, or string. Got {categorical_features.dtype} instead.\"\n682 )\n684 grid, values = _grid_from_X(\n685 _safe_indexing(X, features_indices, axis=1),\n686 percentiles,\n687 is_categorical,\n688 grid_resolution,\n689 )\n691 if method == \"brute\":\n\nValueError: Expected categorical_features to be an array-like of boolean, integer, or string. Got float64 instead.\n```\n\n### Versions\n\n```shell\nSystem:\n    python: 3.10.16 (main, Dec  3 2024, 17:27:57) [Clang 16.0.0 (clang-1600.0.26.4)]\nexecutable: /Users/datategy/papAI/o2_ml/.venv/bin/python\n   machine: macOS-15.3-x86_64-i386-64bit\n\nPython dependencies:\n      sklearn: 1.5.0\n          pip: 25.0.1\n   setuptools: 75.6.0\n        numpy: 1.26.4\n        scipy: 1.13.1\n       Cython: 3.0.12\n       pandas: 1.5.3\n   matplotlib: 3.8.4\n       joblib: 1.2.0\nthreadpoolctl: 3.5.0\n\nBuilt with OpenMP: True\n\nthreadpoolctl info:\n       user_api: blas\n   internal_api: openblas\n    num_threads: 4\n         prefix: libopenblas\n...\n    num_threads: 8\n         prefix: libomp\n       filepath: /usr/local/Cellar/libomp/19.1.7/lib/libomp.dylib\n        version: None\n```",
  "pr_number": 31146,
  "pr_title": "Fix #31077: Improve error when categorical_features is an empty list",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/sklearn.inspection/31146.fix.rst b/doc/whats_new/upcoming_changes/sklearn.inspection/31146.fix.rst\nnew file mode 100644\nindex 0000000000000..105a5e093e693\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/sklearn.inspection/31146.fix.rst\n@@ -0,0 +1,4 @@\n+- :func:`inspection.partial_dependence` now raises an informative error when passing\n+  an empty list as the `categorical_features` parameter. `None` should be used instead\n+  to indicate that no categorical features are present.\n+  By :user:`Pedro Lopes <pedroL0pes>`.\n\\ No newline at end of file\ndiff --git a/sklearn/inspection/_partial_dependence.py b/sklearn/inspection/_partial_dependence.py\nindex 3790eb8a9f78c..82bcc426c489f 100644\n--- a/sklearn/inspection/_partial_dependence.py\n+++ b/sklearn/inspection/_partial_dependence.py\n@@ -673,6 +673,12 @@ def partial_dependence(\n         is_categorical = [False] * len(features_indices)\n     else:\n         categorical_features = np.asarray(categorical_features)\n+        if categorical_features.size == 0:\n+            raise ValueError(\n+                \"Passing an empty list (`[]`) to `categorical_features` is not \"\n+                \"supported. Use `None` instead to indicate that there are no \"\n+                \"categorical features.\"\n+            )\n         if categorical_features.dtype.kind == \"b\":\n             # categorical features provided as a list of boolean\n             if categorical_features.size != n_features:\ndiff --git a/sklearn/inspection/tests/test_partial_dependence.py b/sklearn/inspection/tests/test_partial_dependence.py\nindex 25cefe8d7e24f..816fe5512edc4 100644\n--- a/sklearn/inspection/tests/test_partial_dependence.py\n+++ b/sklearn/inspection/tests/test_partial_dependence.py\n@@ -1196,3 +1196,22 @@ def test_reject_pandas_with_integer_dtype():\n         warnings.simplefilter(\"error\")\n         partial_dependence(clf, X, features=[\"a\"])\n         partial_dependence(clf, X, features=[\"c\"], categorical_features=[\"c\"])\n+\n+\n+def test_partial_dependence_empty_categorical_features():\n+    \"\"\"Check that we raise the proper exception when `categorical_features`\n+    is an empty list\"\"\"\n+    clf = make_pipeline(StandardScaler(), LogisticRegression())\n+    clf.fit(iris.data, iris.target)\n+\n+    with pytest.raises(\n+        ValueError,\n+        match=re.escape(\n+            \"Passing an empty list (`[]`) to `categorical_features` is not \"\n+            \"supported. Use `None` instead to indicate that there are no \"\n+            \"categorical features.\"\n+        ),\n+    ):\n+        partial_dependence(\n+            estimator=clf, X=iris.data, features=[0], categorical_features=[]\n+        )\n",
  "fail_to_pass": [
    "test_partial_dependence_empty_categorical_features"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/inspection/_partial_dependence.py",
    "sklearn/inspection/tests/test_partial_dependence.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-04-03T19:18:13Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/31146",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/issues/31077"
}