{
  "id": "scikit-learn__scikit-learn-30851",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "9ce8be6995995967900d9ed559a3cc712a1e6fa4",
  "issue_number": 1234,
  "issue_title": "MRG fix bincount mess I made in kmeans.",
  "issue_body": "This should clean up the stuff I pushed earlier.\ncc @ogrisel @gaelvaroquaux Could you have a brief look? What I pushed earlier is buggy but I didn't dare push again after so many failed fixes.\n",
  "pr_number": 30851,
  "pr_title": "TST use global_random_seed in sklearn/metrics/tests/test_classification.py",
  "gold_patch": "diff --git a/sklearn/metrics/tests/test_classification.py b/sklearn/metrics/tests/test_classification.py\nindex 21e2eed9b53cc..b67c91737960c 100644\n--- a/sklearn/metrics/tests/test_classification.py\n+++ b/sklearn/metrics/tests/test_classification.py\n@@ -970,8 +970,8 @@ def test_zero_division_nan_warning(metric, y_true, y_pred):\n     assert result == 0.0\n \n \n-def test_matthews_corrcoef_against_numpy_corrcoef():\n-    rng = np.random.RandomState(0)\n+def test_matthews_corrcoef_against_numpy_corrcoef(global_random_seed):\n+    rng = np.random.RandomState(global_random_seed)\n     y_true = rng.randint(0, 2, size=20)\n     y_pred = rng.randint(0, 2, size=20)\n \n@@ -980,11 +980,11 @@ def test_matthews_corrcoef_against_numpy_corrcoef():\n     )\n \n \n-def test_matthews_corrcoef_against_jurman():\n+def test_matthews_corrcoef_against_jurman(global_random_seed):\n     # Check that the multiclass matthews_corrcoef agrees with the definition\n     # presented in Jurman, Riccadonna, Furlanello, (2012). A Comparison of MCC\n     # and CEN Error Measures in MultiClass Prediction\n-    rng = np.random.RandomState(0)\n+    rng = np.random.RandomState(global_random_seed)\n     y_true = rng.randint(0, 2, size=20)\n     y_pred = rng.randint(0, 2, size=20)\n     sample_weight = rng.rand(20)\n@@ -1019,8 +1019,8 @@ def test_matthews_corrcoef_against_jurman():\n     assert_almost_equal(mcc_ours, mcc_jurman, 10)\n \n \n-def test_matthews_corrcoef():\n-    rng = np.random.RandomState(0)\n+def test_matthews_corrcoef(global_random_seed):\n+    rng = np.random.RandomState(global_random_seed)\n     y_true = [\"a\" if i == 0 else \"b\" for i in rng.randint(0, 2, size=20)]\n \n     # corrcoef of same vectors must be 1\n@@ -1054,8 +1054,8 @@ def test_matthews_corrcoef():\n         assert_almost_equal(matthews_corrcoef(y_1, y_2, sample_weight=mask), 0.0)\n \n \n-def test_matthews_corrcoef_multiclass():\n-    rng = np.random.RandomState(0)\n+def test_matthews_corrcoef_multiclass(global_random_seed):\n+    rng = np.random.RandomState(global_random_seed)\n     ord_a = ord(\"a\")\n     n_classes = 4\n     y_true = [chr(ord_a + i) for i in rng.randint(0, n_classes, size=20)]\n@@ -1111,9 +1111,9 @@ def test_matthews_corrcoef_multiclass():\n \n \n @pytest.mark.parametrize(\"n_points\", [100, 10000])\n-def test_matthews_corrcoef_overflow(n_points):\n+def test_matthews_corrcoef_overflow(n_points, global_random_seed):\n     # https://github.com/scikit-learn/scikit-learn/issues/9622\n-    rng = np.random.RandomState(20170906)\n+    rng = np.random.RandomState(global_random_seed)\n \n     def mcc_safe(y_true, y_pred):\n         conf_matrix = confusion_matrix(y_true, y_pred)\n",
  "fail_to_pass": [
    "test_matthews_corrcoef_against_numpy_corrcoef",
    "test_matthews_corrcoef_against_jurman",
    "test_matthews_corrcoef",
    "test_matthews_corrcoef_multiclass",
    "test_matthews_corrcoef_overflow"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/metrics/tests/test_classification.py"
  ],
  "difficulty": "easy",
  "created_at": "2025-02-18T16:52:20Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/30851",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/1234"
}