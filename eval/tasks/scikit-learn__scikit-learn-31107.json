{
  "id": "scikit-learn__scikit-learn-31107",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "2b2da858f9b82abd8d74a7f66b67cfdaf5abd4b9",
  "issue_number": 1234,
  "issue_title": "MRG fix bincount mess I made in kmeans.",
  "issue_body": "This should clean up the stuff I pushed earlier.\ncc @ogrisel @gaelvaroquaux Could you have a brief look? What I pushed earlier is buggy but I didn't dare push again after so many failed fixes.\n",
  "pr_number": 31107,
  "pr_title": "Fix #30936: ElasticNet l1 ratio fails for float-only arrays",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/sklearn.feature_selection/31107.fix.rst b/doc/whats_new/upcoming_changes/sklearn.feature_selection/31107.fix.rst\nnew file mode 100644\nindex 0000000000000..b5ca4ab283434\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/sklearn.feature_selection/31107.fix.rst\n@@ -0,0 +1,4 @@\n+- :class:`feature_selection.SelectFromModel` now correctly works when the estimator\n+  is an instance of :class:`linear_model.ElasticNetCV` with its `l1_ratio` parameter\n+  being an array-like.\n+  By :user:`Vasco Pereira <vasco-s-pereira>`.\ndiff --git a/sklearn/feature_selection/_from_model.py b/sklearn/feature_selection/_from_model.py\nindex d73b53eea647e..92654821c9dff 100644\n--- a/sklearn/feature_selection/_from_model.py\n+++ b/sklearn/feature_selection/_from_model.py\n@@ -35,11 +35,18 @@ def _calculate_threshold(estimator, importances, threshold):\n         est_name = estimator.__class__.__name__\n         is_l1_penalized = hasattr(estimator, \"penalty\") and estimator.penalty == \"l1\"\n         is_lasso = \"Lasso\" in est_name\n-        is_elasticnet_l1_penalized = \"ElasticNet\" in est_name and (\n-            (hasattr(estimator, \"l1_ratio_\") and np.isclose(estimator.l1_ratio_, 1.0))\n-            or (hasattr(estimator, \"l1_ratio\") and np.isclose(estimator.l1_ratio, 1.0))\n+        is_elasticnet_l1_penalized = est_name == \"ElasticNet\" and (\n+            hasattr(estimator, \"l1_ratio\") and np.isclose(estimator.l1_ratio, 1.0)\n         )\n-        if is_l1_penalized or is_lasso or is_elasticnet_l1_penalized:\n+        is_elasticnetcv_l1_penalized = est_name == \"ElasticNetCV\" and (\n+            hasattr(estimator, \"l1_ratio_\") and np.isclose(estimator.l1_ratio_, 1.0)\n+        )\n+        if (\n+            is_l1_penalized\n+            or is_lasso\n+            or is_elasticnet_l1_penalized\n+            or is_elasticnetcv_l1_penalized\n+        ):\n             # the natural default threshold is 0 when l1 penalty was used\n             threshold = 1e-5\n         else:\ndiff --git a/sklearn/feature_selection/tests/test_from_model.py b/sklearn/feature_selection/tests/test_from_model.py\nindex 421f575c92a0e..17bedf44748fb 100644\n--- a/sklearn/feature_selection/tests/test_from_model.py\n+++ b/sklearn/feature_selection/tests/test_from_model.py\n@@ -8,7 +8,7 @@\n from sklearn import datasets\n from sklearn.base import BaseEstimator\n from sklearn.cross_decomposition import CCA, PLSCanonical, PLSRegression\n-from sklearn.datasets import make_friedman1\n+from sklearn.datasets import make_friedman1, make_regression\n from sklearn.decomposition import PCA\n from sklearn.ensemble import HistGradientBoostingClassifier, RandomForestClassifier\n from sklearn.exceptions import NotFittedError\n@@ -489,6 +489,21 @@ def test_prefit_max_features():\n         model.transform(data)\n \n \n+def test_get_feature_names_out_elasticnetcv():\n+    \"\"\"Check if ElasticNetCV works with a list of floats.\n+\n+    Non-regression test for #30936.\"\"\"\n+    X, y = make_regression(n_features=5, n_informative=3, random_state=0)\n+    estimator = ElasticNetCV(l1_ratio=[0.25, 0.5, 0.75], random_state=0)\n+    selector = SelectFromModel(estimator=estimator)\n+    selector.fit(X, y)\n+\n+    names_out = selector.get_feature_names_out()\n+    mask = selector.get_support()\n+    expected = np.array([f\"x{i}\" for i in range(X.shape[1])])[mask]\n+    assert_array_equal(names_out, expected)\n+\n+\n def test_prefit_get_feature_names_out():\n     \"\"\"Check the interaction between prefit and the feature names.\"\"\"\n     clf = RandomForestClassifier(n_estimators=2, random_state=0)\n",
  "fail_to_pass": [
    "test_get_feature_names_out_elasticnetcv"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/feature_selection/_from_model.py",
    "sklearn/feature_selection/tests/test_from_model.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-03-30T18:10:57Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/31107",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/1234"
}