{
  "id": "scikit-learn__scikit-learn-30299",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "6bf2061f76ba0977c1f7ffb9ddc48db794e5c7ec",
  "issue_number": 30298,
  "issue_title": "Make transition from 1.5 to 1.6 easier for third-party library using scikit-learn utilities",
  "issue_body": "In 1.6, we introduced several breaking changes:\r\n\r\n- `self._validate_data` became `sklearn.utils.validation.validate_data`\r\n- `self._check_n_features` became `sklearn.utils.validation.check_n_features`\r\n- `self._check_feature_names` became `sklearn.utils.validation.check_feature_names`\r\n- a complete revamp for the tag infrastructure\r\n\r\nWhile that all these changes are intended to improve the quality of life of third-party libraries by providing public utilities, it is going to break estimators and will require some boilerplate code to be compatible across scikit-learn version.\r\n\r\nWhile those tools are private, it seems that we should still make a deprecation cycle such that we warn about the changes and start to raise error in future version (1.8).",
  "pr_number": 30299,
  "pr_title": "MAINT add deprecation for transition to new developer API tools",
  "gold_patch": "diff --git a/sklearn/base.py b/sklearn/base.py\nindex bd5e07c2167dd..d646f8d3e56bf 100644\n--- a/sklearn/base.py\n+++ b/sklearn/base.py\n@@ -30,11 +30,14 @@\n )\n from .utils.fixes import _IS_32BIT\n from .utils.validation import (\n+    _check_feature_names,\n     _check_feature_names_in,\n+    _check_n_features,\n     _generate_get_feature_names_out,\n     _is_fitted,\n     check_array,\n     check_is_fitted,\n+    validate_data,\n )\n \n \n@@ -439,6 +442,35 @@ def _repr_mimebundle_(self, **kwargs):\n             output[\"text/html\"] = estimator_html_repr(self)\n         return output\n \n+    # TODO(1.7): Remove this method\n+    def _validate_data(self, *args, **kwargs):\n+        warnings.warn(\n+            \"`BaseEstimator._validate_data` is deprecated in 1.6 and will be removed \"\n+            \"in 1.7. Use `sklearn.utils.validation.validate_data` instead. This \"\n+            \"function becomes public and is part of the scikit-learn developer API.\",\n+            FutureWarning,\n+        )\n+        return validate_data(self, *args, **kwargs)\n+\n+    # TODO(1.7): Remove this method\n+    def _check_n_features(self, *args, **kwargs):\n+        warnings.warn(\n+            \"`BaseEstimator._check_n_features` is deprecated in 1.6 and will be \"\n+            \"removed in 1.7. Use `sklearn.utils.validation._check_n_features` instead.\",\n+            FutureWarning,\n+        )\n+        _check_n_features(self, *args, **kwargs)\n+\n+    # TODO(1.7): Remove this method\n+    def _check_feature_names(self, *args, **kwargs):\n+        warnings.warn(\n+            \"`BaseEstimator._check_feature_names` is deprecated in 1.6 and will be \"\n+            \"removed in 1.7. Use `sklearn.utils.validation._check_feature_names` \"\n+            \"instead.\",\n+            FutureWarning,\n+        )\n+        _check_feature_names(self, *args, **kwargs)\n+\n \n class ClassifierMixin:\n     \"\"\"Mixin class for all classifiers in scikit-learn.\ndiff --git a/sklearn/tests/test_common.py b/sklearn/tests/test_common.py\nindex d54916059c163..59b45b93a7e24 100644\n--- a/sklearn/tests/test_common.py\n+++ b/sklearn/tests/test_common.py\n@@ -19,6 +19,7 @@\n import sklearn\n from sklearn.base import BaseEstimator\n from sklearn.compose import ColumnTransformer\n+from sklearn.datasets import make_classification\n from sklearn.exceptions import ConvergenceWarning\n \n # make it possible to discover experimental estimators when calling `all_estimators`\n@@ -403,3 +404,37 @@ def test_check_inplace_ensure_writeable(estimator):\n         estimator.set_params(kernel=\"precomputed\")\n \n     check_inplace_ensure_writeable(name, estimator)\n+\n+\n+# TODO(1.7): Remove this test when the deprecation cycle is over\n+def test_transition_public_api_deprecations():\n+    \"\"\"This test checks that we raised deprecation warning explaining how to transition\n+    to the new developer public API from 1.5 to 1.6.\n+    \"\"\"\n+\n+    class OldEstimator(BaseEstimator):\n+        def fit(self, X, y=None):\n+            X = self._validate_data(X)\n+            self._check_n_features(X, reset=True)\n+            self._check_feature_names(X, reset=True)\n+            return self\n+\n+        def transform(self, X):\n+            return X  # pragma: no cover\n+\n+    X, y = make_classification(n_samples=10, n_features=5, random_state=0)\n+\n+    old_estimator = OldEstimator()\n+    with pytest.warns(FutureWarning) as warning_list:\n+        old_estimator.fit(X)\n+\n+    assert len(warning_list) == 3\n+    assert str(warning_list[0].message).startswith(\n+        \"`BaseEstimator._validate_data` is deprecated\"\n+    )\n+    assert str(warning_list[1].message).startswith(\n+        \"`BaseEstimator._check_n_features` is deprecated\"\n+    )\n+    assert str(warning_list[2].message).startswith(\n+        \"`BaseEstimator._check_feature_names` is deprecated\"\n+    )\n",
  "fail_to_pass": [
    "test_transition_public_api_deprecations"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/base.py",
    "sklearn/tests/test_common.py"
  ],
  "difficulty": "medium",
  "created_at": "2024-11-18T15:59:41Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/30299",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/issues/30298"
}