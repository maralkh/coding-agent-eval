{
  "id": "scikit-learn__scikit-learn-31528",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "dab084231912cb8bbb70bae52872b06bf6d2ee0f",
  "issue_number": 1234,
  "issue_title": "MRG fix bincount mess I made in kmeans.",
  "issue_body": "This should clean up the stuff I pushed earlier.\ncc @ogrisel @gaelvaroquaux Could you have a brief look? What I pushed earlier is buggy but I didn't dare push again after so many failed fixes.\n",
  "pr_number": 31528,
  "pr_title": "FIX fix comparison between array-like parameters when detecting non-default params for HTML representation",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/sklearn.base/31528.fix.rst b/doc/whats_new/upcoming_changes/sklearn.base/31528.fix.rst\nnew file mode 100644\nindex 0000000000000..312c8318eadcd\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/sklearn.base/31528.fix.rst\n@@ -0,0 +1,3 @@\n+- Fix regression in HTML representation when detecting the non-default parameters\n+  that where of array-like types.\n+  By :user:`Dea Mar\u00eda L\u00e9on <deamarialeon>`\ndiff --git a/sklearn/base.py b/sklearn/base.py\nindex 309b482357e12..e9308d8f1376f 100644\n--- a/sklearn/base.py\n+++ b/sklearn/base.py\n@@ -292,12 +292,14 @@ def is_non_default(param_name, param_value):\n                 init_default_params[param_name]\n             ):\n                 return True\n-\n-            if param_value != init_default_params[param_name] and not (\n+            if not np.array_equal(\n+                param_value, init_default_params[param_name]\n+            ) and not (\n                 is_scalar_nan(init_default_params[param_name])\n                 and is_scalar_nan(param_value)\n             ):\n                 return True\n+\n             return False\n \n         # reorder the parameters from `self.get_params` using the `__init__`\ndiff --git a/sklearn/tests/test_base.py b/sklearn/tests/test_base.py\nindex e57d36351f0d4..0842cf0c82b48 100644\n--- a/sklearn/tests/test_base.py\n+++ b/sklearn/tests/test_base.py\n@@ -26,7 +26,8 @@\n from sklearn.decomposition import PCA\n from sklearn.ensemble import IsolationForest\n from sklearn.exceptions import InconsistentVersionWarning\n-from sklearn.model_selection import GridSearchCV\n+from sklearn.metrics import get_scorer\n+from sklearn.model_selection import GridSearchCV, KFold\n from sklearn.pipeline import Pipeline\n from sklearn.preprocessing import StandardScaler\n from sklearn.svm import SVC, SVR\n@@ -1000,3 +1001,81 @@ def test_get_params_html():\n \n     assert est._get_params_html() == {\"l1\": 0, \"empty\": \"test\"}\n     assert est._get_params_html().non_default == (\"empty\",)\n+\n+\n+def make_estimator_with_param(default_value):\n+    class DynamicEstimator(BaseEstimator):\n+        def __init__(self, param=default_value):\n+            self.param = param\n+\n+    return DynamicEstimator\n+\n+\n+@pytest.mark.parametrize(\n+    \"default_value, test_value\",\n+    [\n+        ((), (1,)),\n+        ((), [1]),\n+        ((), np.array([1])),\n+        ((1, 2), (3, 4)),\n+        ((1, 2), [3, 4]),\n+        ((1, 2), np.array([3, 4])),\n+        (None, 1),\n+        (None, []),\n+        (None, lambda x: x),\n+        (np.nan, 1.0),\n+        (np.nan, np.array([np.nan])),\n+        (\"abc\", \"def\"),\n+        (\"abc\", [\"abc\"]),\n+        (True, False),\n+        (1, 2),\n+        (1, [1]),\n+        (1, np.array([1])),\n+        (1.0, 2.0),\n+        (1.0, [1.0]),\n+        (1.0, np.array([1.0])),\n+        ([1, 2], [3]),\n+        (np.array([1]), [2, 3]),\n+        (None, KFold()),\n+        (None, get_scorer(\"accuracy\")),\n+    ],\n+)\n+def test_param_is_non_default(default_value, test_value):\n+    \"\"\"Check that we detect non-default parameters with various types.\n+\n+    Non-regression test for:\n+    https://github.com/scikit-learn/scikit-learn/issues/31525\n+    \"\"\"\n+    estimator = make_estimator_with_param(default_value)(param=test_value)\n+    non_default = estimator._get_params_html().non_default\n+    assert \"param\" in non_default\n+\n+\n+@pytest.mark.parametrize(\n+    \"default_value, test_value\",\n+    [\n+        (None, None),\n+        ((), ()),\n+        ((), []),\n+        ((), np.array([])),\n+        ((1, 2, 3), (1, 2, 3)),\n+        ((1, 2, 3), [1, 2, 3]),\n+        ((1, 2, 3), np.array([1, 2, 3])),\n+        (np.nan, np.nan),\n+        (\"abc\", \"abc\"),\n+        (True, True),\n+        (1, 1),\n+        (1.0, 1.0),\n+        (2, 2.0),\n+    ],\n+)\n+def test_param_is_default(default_value, test_value):\n+    \"\"\"Check that we detect the default parameters and values in an array-like will\n+    be reported as default as well.\n+\n+    Non-regression test for:\n+    https://github.com/scikit-learn/scikit-learn/issues/31525\n+    \"\"\"\n+    estimator = make_estimator_with_param(default_value)(param=test_value)\n+    non_default = estimator._get_params_html().non_default\n+    assert \"param\" not in non_default\n",
  "fail_to_pass": [
    "test_param_is_non_default",
    "test_param_is_default"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/base.py",
    "sklearn/tests/test_base.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-06-12T06:55:34Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/31528",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/1234"
}