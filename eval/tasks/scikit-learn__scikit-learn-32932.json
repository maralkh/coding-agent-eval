{
  "id": "scikit-learn__scikit-learn-32932",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "b0ba8b029c298e0cc545206d2df4757be0ec2ac2",
  "issue_number": 32927,
  "issue_title": "`LogisticRegression`: Conflicting warnings when following deprecation advice for `penalty=None` (sklearn 1.8.0)",
  "issue_body": "### Describe the bug\n\nI am encountering a catch-22 situation with `LogisticRegression` warnings in scikit-learn 1.8.0.\n\nWhen I use `LogisticRegression(penalty=None)`, I get a `FutureWarning` advising me to use `C=np.inf` instead. However, when I follow this advice and use `LogisticRegression(C=np.inf)` (leaving `penalty` at its default), I get **both** the `FutureWarning` again and a `UserWarning` stating that `C` is ignored because `penalty=None`.\n\nIt seems that `C=np.inf` correctly disables regularization (effectively setting `penalty=None` internally), but this internal state then triggers the warning intended for users who explicitly pass conflicting arguments.\n\n\n### Steps/Code to Reproduce\n\n```python\nimport sys\nimport warnings\nimport numpy as np\nimport sklearn\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.datasets import make_classification\n\nX, y = make_classification(random_state=42)\n\nprint(\"LogisticRegression default params:\", LogisticRegression().get_params())\nprint()\n\nwith warnings.catch_warnings(record=True) as w:\n    warnings.simplefilter(\"always\")\n\n    print(\"--- Case 1: penalty=None ---\")\n    LogisticRegression(penalty=None).fit(X, y)\n    for warning in w:\n        print(f\"{warning.category.__name__}: {warning.message}\")\n\n    print(\"\\n--- Case 2: l1_ratio=0, C=np.inf ---\")\n    LogisticRegression(l1_ratio=0, C=np.inf).fit(X, y)\n    for warning in w:\n        print(f\"{warning.category.__name__}: {warning.message}\")\n```\n\n### Expected Results\n\nUsing `C=np.inf` (with default `penalty`) should be the correct way to specify no regularization without triggering warnings, as per the `FutureWarning` message. It should definitely not trigger a `UserWarning` claiming that `C` is ignored, since `C` was the parameter used to request this behavior.\n\n### Actual Results\n\n\n```text\nLogisticRegression default params: {'C': 1.0, 'class_weight': None, 'dual': False, 'fit_intercept': True, 'intercept_scaling': 1, 'l1_ratio': 0.0, 'max_iter': 100, 'n_jobs': None, 'penalty': 'deprecated', 'random_state': None, 'solver': 'lbfgs', 'tol': 0.0001, 'verbose': 0, 'warm_start': False}\n\n--- Case 1: penalty=None ---\nFutureWarning: 'penalty' was deprecated in version 1.8 and will be removed in 1.10. To avoid this warning, leave 'penalty' set to its default value and use 'l1_ratio' or 'C' instead. Use l1_ratio=0 instead of penalty='l2', l1_ratio=1 instead of penalty='l1', and C=np.inf instead of penalty=None.\n\n--- Case 2: l1_ratio=0, C=np.inf ---\nFutureWarning: 'penalty' was deprecated in version 1.8 and will be removed in 1.10. To avoid this warning, leave 'penalty' set to its default value and use 'l1_ratio' or 'C' instead. Use l1_ratio=0 instead of penalty='l2', l1_ratio=1 instead of penalty='l1', and C=np.inf instead of penalty=None.\nUserWarning: Setting penalty=None will ignore the C and l1_ratio parameters\n```\n\n### Versions\n\n```shell\nSystem:\n    python: 3.13.3 (main, Apr  9 2025, 03:47:57) [Clang 20.1.0 ]\nexecutable: /Users/rubens.filho/projects/pers/robust/.venv/bin/python\n   machine: macOS-15.7.3-arm64-arm-64bit-Mach-O\n\nPython dependencies:\n      sklearn: 1.8.0\n          pip: None\n   setuptools: None\n        numpy: 2.3.5\n        scipy: 1.16.3\n       Cython: None\n       pandas: 2.3.3\n   matplotlib: 3.10.8\n       joblib: 1.5.2\nthreadpoolctl: 3.6.0\n\nBuilt with OpenMP: True\n\nthreadpoolctl info:\n       user_api: openmp\n   internal_api: openmp\n    num_threads: 10\n         prefix: libomp\n       filepath: /Users/rubens.filho/projects/pers/robust/.venv/lib/python3.13/site-packages/sklearn/.dylibs/libomp.dylib\n        version: None\n```",
  "pr_number": 32932,
  "pr_title": "FIX Avoid LogisticRegression spurious warning with `C=np.inf`",
  "gold_patch": "diff --git a/sklearn/linear_model/_logistic.py b/sklearn/linear_model/_logistic.py\nindex b494a2495e356..e3ce9dd12efa0 100644\n--- a/sklearn/linear_model/_logistic.py\n+++ b/sklearn/linear_model/_logistic.py\n@@ -1165,8 +1165,8 @@ def fit(self, X, y, sample_weight=None):\n         if penalty == \"elasticnet\" and self.l1_ratio is None:\n             raise ValueError(\"l1_ratio must be specified when penalty is elasticnet.\")\n \n-        if penalty is None:\n-            if self.C != 1.0:  # default values\n+        if self.penalty is None:\n+            if self.C != 1.0:  # default value\n                 warnings.warn(\n                     \"Setting penalty=None will ignore the C and l1_ratio parameters\"\n                 )\ndiff --git a/sklearn/linear_model/tests/test_logistic.py b/sklearn/linear_model/tests/test_logistic.py\nindex 9cf34d9552307..da5df658f8099 100644\n--- a/sklearn/linear_model/tests/test_logistic.py\n+++ b/sklearn/linear_model/tests/test_logistic.py\n@@ -2257,6 +2257,23 @@ def test_penalty_none(global_random_seed, solver):\n     assert_array_equal(pred_none, pred_l2_C_inf)\n \n \n+# TODO(1.10): remove whole test with the removal of penalty\n+@pytest.mark.parametrize(\"solver\", sorted(set(SOLVERS) - set([\"liblinear\"])))\n+def test_c_inf_no_warning(solver):\n+    \"\"\"Test that C=np.inf (recommended approach) produces no warnings.\n+\n+    Non-regression test for:\n+    https://github.com/scikit-learn/scikit-learn/issues/32927\n+    \"\"\"\n+    X, y = make_classification(n_samples=100, n_redundant=0, random_state=42)\n+\n+    lr = LogisticRegression(C=np.inf, solver=solver)\n+    with warnings.catch_warnings():\n+        warnings.simplefilter(\"error\")\n+        warnings.filterwarnings(\"ignore\", category=ConvergenceWarning)\n+        lr.fit(X, y)\n+\n+\n # XXX: investigate thread-safety bug that might be related to:\n # https://github.com/scikit-learn/scikit-learn/issues/31883\n @pytest.mark.thread_unsafe\n",
  "fail_to_pass": [
    "test_c_inf_no_warning"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/linear_model/_logistic.py",
    "sklearn/linear_model/tests/test_logistic.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-12-23T09:05:22Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/32932",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/issues/32927"
}