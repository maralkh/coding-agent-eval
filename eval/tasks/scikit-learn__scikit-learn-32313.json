{
  "id": "scikit-learn__scikit-learn-32313",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "4e4acc5c0c2ef88fe67c2b8f1f8c4464e34f0271",
  "issue_number": 30508,
  "issue_title": "ENH add `from_cv_results` in `PrecisionRecallDisplay` (single Display)",
  "issue_body": "#### Reference Issues/PRs\r\nFollows on from  #30399\r\n\r\n#### What does this implement/fix? Explain your changes.\r\nProof of concept of adding multi displays to `PrecisionRecallDisplay`\r\n\r\n* A lot of the code is similar to that in #30399, so we can definitely factorize out, though small intricacies may make it complex \r\n* The `plot` method is complex due to handling both single and multi curve and doing a lot more checking, as user is able to use it outside of the `from_estimator` and `from_predictions` methods.\r\n\r\nDetailed discussions of problems in review comments.\r\n\r\n#### Any other comments?\r\n\r\ncc @glemaitre @jeremiedbb \r\n\r\n",
  "pr_number": 32313,
  "pr_title": "FIX: Only over-write specified default kwargs in Displays",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/sklearn.metrics/32313.fix.rst b/doc/whats_new/upcoming_changes/sklearn.metrics/32313.fix.rst\nnew file mode 100644\nindex 0000000000000..b8f0fc21660da\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/sklearn.metrics/32313.fix.rst\n@@ -0,0 +1,5 @@\n+- kwargs specified in the `curve_kwargs` parameter of\n+  :meth:`metrics.RocCurveDisplay.from_cv_results` now only overwrite their corresponding\n+  default value before being passed to Matplotlib's `plot`. Previously, passing any\n+  `curve_kwargs` would overwrite all default kwargs.\n+  By :user:`Lucy Liu <lucyleeow>`.\ndiff --git a/sklearn/metrics/_plot/roc_curve.py b/sklearn/metrics/_plot/roc_curve.py\nindex 22bf9758963e1..0ea96733dcf4f 100644\n--- a/sklearn/metrics/_plot/roc_curve.py\n+++ b/sklearn/metrics/_plot/roc_curve.py\n@@ -253,6 +253,11 @@ def plot(\n             legend_metric,\n             \"AUC\",\n             curve_kwargs=curve_kwargs,\n+            default_multi_curve_kwargs={\n+                \"alpha\": 0.5,\n+                \"linestyle\": \"--\",\n+                \"color\": \"blue\",\n+            },\n             **kwargs,\n         )\n \ndiff --git a/sklearn/metrics/_plot/tests/test_roc_curve_display.py b/sklearn/metrics/_plot/tests/test_roc_curve_display.py\nindex 6566254a09f9a..72c636acd33cf 100644\n--- a/sklearn/metrics/_plot/tests/test_roc_curve_display.py\n+++ b/sklearn/metrics/_plot/tests/test_roc_curve_display.py\n@@ -320,6 +320,10 @@ def test_roc_curve_display_from_cv_results_curve_kwargs(\n             line.get_alpha() == curve_kwargs[i][\"alpha\"]\n             for i, line in enumerate(display.line_)\n         )\n+    # Other default kwargs should be the same\n+    for line in display.line_:\n+        assert line.get_linestyle() == \"--\"\n+        assert line.get_color() == \"blue\"\n \n \n # TODO(1.9): Remove in 1.9\ndiff --git a/sklearn/utils/_plotting.py b/sklearn/utils/_plotting.py\nindex 304c772d5970a..3e247e5fc4a93 100644\n--- a/sklearn/utils/_plotting.py\n+++ b/sklearn/utils/_plotting.py\n@@ -126,6 +126,8 @@ def _validate_curve_kwargs(\n         legend_metric,\n         legend_metric_name,\n         curve_kwargs,\n+        default_curve_kwargs=None,\n+        default_multi_curve_kwargs=None,\n         **kwargs,\n     ):\n         \"\"\"Get validated line kwargs for each curve.\n@@ -152,6 +154,14 @@ def _validate_curve_kwargs(\n             dictionary is provided, the same parameters are applied to all\n             curves.\n \n+        default_curve_kwargs : dict, default=None\n+            Default curve kwargs, to be added to all curves. Individual kwargs\n+            are over-ridden by `curve_kwargs`, if kwarg also set in `curve_kwargs`.\n+\n+        default_multi_curve_kwargs : dict, default=None\n+            Default curve kwargs for multi-curve plots. Individual kwargs\n+            are over-ridden by `curve_kwargs`, if kwarg also set in `curve_kwargs`.\n+\n         **kwargs : dict\n             Deprecated. Keyword arguments to be passed to matplotlib's `plot`.\n         \"\"\"\n@@ -199,13 +209,16 @@ def _validate_curve_kwargs(\n         # Ensure `curve_kwargs` is of correct length\n         if isinstance(curve_kwargs, Mapping):\n             curve_kwargs = [curve_kwargs] * n_curves\n+        elif curve_kwargs is None:\n+            curve_kwargs = [{}] * n_curves\n \n-        default_multi_curve_kwargs = {\"alpha\": 0.5, \"linestyle\": \"--\", \"color\": \"blue\"}\n-        if curve_kwargs is None:\n-            if n_curves > 1:\n-                curve_kwargs = [default_multi_curve_kwargs] * n_curves\n-            else:\n-                curve_kwargs = [{}]\n+        if default_curve_kwargs is None:\n+            default_curve_kwargs = {}\n+        if default_multi_curve_kwargs is None:\n+            default_multi_curve_kwargs = {}\n+\n+        if n_curves > 1:\n+            default_curve_kwargs.update(default_multi_curve_kwargs)\n \n         labels = []\n         if \"mean\" in legend_metric:\n@@ -235,7 +248,9 @@ def _validate_curve_kwargs(\n                 )\n \n         curve_kwargs_ = [\n-            _validate_style_kwargs({\"label\": label}, curve_kwargs[fold_idx])\n+            _validate_style_kwargs(\n+                {\"label\": label, **default_curve_kwargs}, curve_kwargs[fold_idx]\n+            )\n             for fold_idx, label in enumerate(labels)\n         ]\n         return curve_kwargs_\ndiff --git a/sklearn/utils/tests/test_plotting.py b/sklearn/utils/tests/test_plotting.py\nindex f74a0fdd523aa..f7a585824ff84 100644\n--- a/sklearn/utils/tests/test_plotting.py\n+++ b/sklearn/utils/tests/test_plotting.py\n@@ -267,19 +267,10 @@ def test_validate_curve_kwargs_error():\n @pytest.mark.parametrize(\"name\", [None, \"curve_name\", [\"curve_name\"]])\n @pytest.mark.parametrize(\n     \"legend_metric\",\n-    [\n-        {\"mean\": 0.8, \"std\": 0.2},\n-        {\"mean\": None, \"std\": None},\n-    ],\n+    [{\"mean\": 0.8, \"std\": 0.2}, {\"mean\": None, \"std\": None}],\n )\n @pytest.mark.parametrize(\"legend_metric_name\", [\"AUC\", \"AP\"])\n-@pytest.mark.parametrize(\n-    \"curve_kwargs\",\n-    [\n-        None,\n-        {\"color\": \"red\"},\n-    ],\n-)\n+@pytest.mark.parametrize(\"curve_kwargs\", [None, {\"color\": \"red\"}])\n def test_validate_curve_kwargs_single_legend(\n     name, legend_metric, legend_metric_name, curve_kwargs\n ):\n@@ -312,14 +303,9 @@ def test_validate_curve_kwargs_single_legend(\n     assert curve_kwargs_out[1][\"label\"] is None\n     assert curve_kwargs_out[2][\"label\"] is None\n \n-    # Default multi-curve kwargs\n     if curve_kwargs is None:\n-        assert all(len(kwargs) == 4 for kwargs in curve_kwargs_out)\n-        assert all(kwargs[\"alpha\"] == 0.5 for kwargs in curve_kwargs_out)\n-        assert all(kwargs[\"linestyle\"] == \"--\" for kwargs in curve_kwargs_out)\n-        assert all(kwargs[\"color\"] == \"blue\" for kwargs in curve_kwargs_out)\n+        assert all(\"color\" not in kwargs for kwargs in curve_kwargs_out)\n     else:\n-        assert all(len(kwargs) == 2 for kwargs in curve_kwargs_out)\n         assert all(kwargs[\"color\"] == \"red\" for kwargs in curve_kwargs_out)\n \n \n@@ -362,11 +348,42 @@ def test_validate_curve_kwargs_multi_legend(name, legend_metric, legend_metric_n\n     for idx, expected_label in enumerate(expected_labels):\n         assert curve_kwargs_out[idx][\"label\"] == expected_label\n \n-    assert all(len(kwargs) == 2 for kwargs in curve_kwargs_out)\n     for curve_kwarg, curve_kwarg_out in zip(curve_kwargs, curve_kwargs_out):\n         assert curve_kwarg_out[\"color\"] == curve_kwarg[\"color\"]\n \n \n+@pytest.mark.parametrize(\"curve_kwargs\", [None, {\"color\": \"red\"}])\n+@pytest.mark.parametrize(\"n_curves\", [1, 3])\n+def test_validate_curve_kwargs_default_kwargs(n_curves, curve_kwargs):\n+    \"\"\"Check default kwargs are incorporated correctly.\"\"\"\n+    curve_kwargs_out = _BinaryClassifierCurveDisplayMixin._validate_curve_kwargs(\n+        n_curves=n_curves,\n+        name=\"test\",\n+        legend_metric={\"mean\": 0.8, \"std\": 0.2},\n+        legend_metric_name=\"metric\",\n+        curve_kwargs=curve_kwargs,\n+        default_curve_kwargs={\"color\": \"blue\"},\n+        default_multi_curve_kwargs={\"alpha\": 0.7, \"linestyle\": \"--\", \"color\": \"green\"},\n+    )\n+    if n_curves > 1:\n+        # `default_multi_curve_kwargs` are incorporated\n+        assert all(kwarg[\"alpha\"] == 0.7 for kwarg in curve_kwargs_out)\n+        assert all(kwarg[\"linestyle\"] == \"--\" for kwarg in curve_kwargs_out)\n+        if curve_kwargs is None:\n+            # `default_multi_curve_kwargs` over-rides `default_curve_kwargs`\n+            assert all(kwarg[\"color\"] == \"green\" for kwarg in curve_kwargs_out)\n+        else:\n+            # `curve_kwargs` over-rides any defaults\n+            assert all(kwarg[\"color\"] == \"red\" for kwarg in curve_kwargs_out)\n+    # Single curve\n+    elif curve_kwargs is None:\n+        # Use `default_curve_kwargs`\n+        assert all(kwarg[\"color\"] == \"blue\" for kwarg in curve_kwargs_out)\n+    else:\n+        # Use `curve_kwargs`\n+        assert all(kwarg[\"color\"] == \"red\" for kwarg in curve_kwargs_out)\n+\n+\n def metric():\n     pass  # pragma: no cover\n \n",
  "fail_to_pass": [
    "test_validate_curve_kwargs_default_kwargs"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/metrics/_plot/roc_curve.py",
    "sklearn/metrics/_plot/tests/test_roc_curve_display.py",
    "sklearn/utils/_plotting.py",
    "sklearn/utils/tests/test_plotting.py"
  ],
  "difficulty": "hard",
  "created_at": "2025-10-01T14:52:30Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/32313",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/30508"
}