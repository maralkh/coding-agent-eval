{
  "id": "scikit-learn__scikit-learn-31891",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "1a6e34cef509f8a51fd6327b87485b300e793abf",
  "issue_number": 30859,
  "issue_title": "FIX `LogisticRegressionCV.score` and `_BaseScorer` metadata routing",
  "issue_body": "Fixes #30817\r\n\r\nDepends on #31891, #31898\r\n\r\nTwo issues fixed in this PR:\r\n- `LogisticRegressionCV` had a `sample_weight` arg in its `score`, which makes it a _consumer_ of it, while being a _router_. This PR removes `sample_weight` as a _consumer_ arg from that method\r\n- `_BaseScorer` wasn't implementing a `get_metadata_routing` and as a result the default implementation wasn't correctly detecting `sample_weight` in the `__call__` signature of those scorers\r\n\r\nNeeds tests and refining the error message regarding `scorer.__call__`\r\n\r\ncc @dalesrox, @antoinebaker ",
  "pr_number": 31891,
  "pr_title": "FIX make scorer.repr work with a partial score_func",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/sklearn.metrics/31891.fix.rst b/doc/whats_new/upcoming_changes/sklearn.metrics/31891.fix.rst\nnew file mode 100644\nindex 0000000000000..f1f280859a1e5\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/sklearn.metrics/31891.fix.rst\n@@ -0,0 +1,3 @@\n+- `repr` on a scorer which has been created with a `partial` `score_func` now correctly\n+  works and uses the `repr` of the given `partial` object.\n+  By `Adrin Jalali`_.\ndiff --git a/sklearn/metrics/_scorer.py b/sklearn/metrics/_scorer.py\nindex 42745656c1276..f23c327529016 100644\n--- a/sklearn/metrics/_scorer.py\n+++ b/sklearn/metrics/_scorer.py\n@@ -102,6 +102,14 @@ def _cached_call(cache, estimator, response_method, *args, **kwargs):\n     return result\n \n \n+def _get_func_repr_or_name(func):\n+    \"\"\"Returns the name of the function or repr of a partial.\"\"\"\n+    if isinstance(func, partial):\n+        return repr(func)\n+\n+    return func.__name__\n+\n+\n class _MultimetricScorer:\n     \"\"\"Callable for multimetric scoring used to avoid repeated calls\n     to `predict_proba`, `predict`, and `decision_function`.\n@@ -262,7 +270,7 @@ def __repr__(self):\n         kwargs_string = \"\".join([f\", {k}={v}\" for k, v in self._kwargs.items()])\n \n         return (\n-            f\"make_scorer({self._score_func.__name__}{sign_string}\"\n+            f\"make_scorer({_get_func_repr_or_name(self._score_func)}{sign_string}\"\n             f\"{response_method_string}{kwargs_string})\"\n         )\n \ndiff --git a/sklearn/metrics/tests/test_score_objects.py b/sklearn/metrics/tests/test_score_objects.py\nindex 672ed8ae7eecc..9ac2509ab9f24 100644\n--- a/sklearn/metrics/tests/test_score_objects.py\n+++ b/sklearn/metrics/tests/test_score_objects.py\n@@ -1,5 +1,6 @@\n import numbers\n import pickle\n+import re\n import warnings\n from copy import deepcopy\n from functools import partial\n@@ -218,6 +219,15 @@ def test_all_scorers_repr():\n         repr(get_scorer(name))\n \n \n+def test_repr_partial():\n+    metric = partial(precision_score, pos_label=1)\n+    scorer = make_scorer(metric)\n+    pattern = (\n+        \"functools\\\\.partial\\\\(<function\\\\ precision_score\\\\ at\\\\ .*>,\\\\ pos_label=1\\\\)\"\n+    )\n+    assert re.search(pattern, repr(scorer))\n+\n+\n def check_scoring_validator_for_single_metric_usecases(scoring_validator):\n     # Test all branches of single metric usecases\n     estimator = EstimatorWithFitAndScore()\n",
  "fail_to_pass": [
    "test_repr_partial"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/metrics/_scorer.py",
    "sklearn/metrics/tests/test_score_objects.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-08-07T11:32:26Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/31891",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/30859"
}