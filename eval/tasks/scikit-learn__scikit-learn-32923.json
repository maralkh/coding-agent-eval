{
  "id": "scikit-learn__scikit-learn-32923",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "86acf4547ed8e183cb75c07bcd68ef186a223f06",
  "issue_number": 10010,
  "issue_title": "Different(wrong?) meaning of pos_label=None",
  "issue_body": "Currently, in scikit-learn, we have multiple definitions of pos_label=None and the doc seems not clear, which might confuse users.\r\n(1) precision/recall/f1/fbeta: do not support pos_label=None\r\n(2) brier_score_loss: default pos_label=None, means the greater of two values (the implementation currently under fix by me in #9562)\r\n(3) precision_recall_curve/roc_auc_curve: default pos_label=None, means pos_label=1\r\n\r\nAccording to @jnothman \r\n \r\n> Actually, I suspect None should mean \"the greater of two values\" (unless there is only one value present).\r\n\r\npossible solutions:\r\n(1)deprecate pos_label=None and change the default value to 1\r\n(2)correct the behaviour of pos_label=None in precision_recall_curve/roc_auc_curve\r\n(3)ignore the difference and simply update the doc\r\n\r\nPersonally, I advocate for (1), at least in precision_recall_curve/roc_auc_curve, because\r\n(1) It will not influence user's code too much, unless you are using something like y_true = ['a', 'b'] and don't provide a pos_label. In this case, it seems not reasonable to let scikit-learn set pos_label='b' for you. \r\n(2) We don't have a correct implementation of pos_label=None in scikit-learn currently. The meaning of pos_label=None is hard to understand by user and hard to define. If there are two labels, ok, we pick the greater one. How about the situation if there is only one label? Pick that one? I'm afraid it is not always the case ,e.g., when there's only negative samples.\r\n\r\ncc @jnothman",
  "pr_number": 32923,
  "pr_title": "FIX array API support when `pos_label=None` for brier score metrics",
  "gold_patch": "diff --git a/doc/whats_new/upcoming_changes/array-api/32923.fix.rst b/doc/whats_new/upcoming_changes/array-api/32923.fix.rst\nnew file mode 100644\nindex 0000000000000..ea18ff7aabaca\n--- /dev/null\n+++ b/doc/whats_new/upcoming_changes/array-api/32923.fix.rst\n@@ -0,0 +1,3 @@\n+- Fixes how `pos_label` is inferred when `pos_label` is set to `None`, in\n+  :func:`sklearn.metrics.brier_score_loss` and\n+  :func:`sklearn.metrics.d2_brier_score`. By :user:`Lucy Liu <lucyleeow>`.\ndiff --git a/sklearn/metrics/_classification.py b/sklearn/metrics/_classification.py\nindex 81f8712af0232..227a3a6d7e416 100644\n--- a/sklearn/metrics/_classification.py\n+++ b/sklearn/metrics/_classification.py\n@@ -3614,10 +3614,11 @@ def _validate_binary_probabilistic_prediction(y_true, y_prob, sample_weight, pos\n     try:\n         pos_label = _check_pos_label_consistency(pos_label, y_true)\n     except ValueError:\n-        classes = np.unique(y_true)\n-        if classes.dtype.kind not in (\"O\", \"U\", \"S\"):\n-            # for backward compatibility, if classes are not string then\n-            # `pos_label` will correspond to the greater label\n+        xp_y_true, _ = get_namespace(y_true)\n+        classes = xp_y_true.unique_values(y_true)\n+        # For backward compatibility, if classes are not string then\n+        # `pos_label` will correspond to the greater label.\n+        if not (_is_numpy_namespace(xp_y_true) and classes.dtype.kind in \"OUS\"):\n             pos_label = classes[-1]\n         else:\n             raise\ndiff --git a/sklearn/metrics/tests/test_classification.py b/sklearn/metrics/tests/test_classification.py\nindex 6642fce16d64e..eb267ccf5e696 100644\n--- a/sklearn/metrics/tests/test_classification.py\n+++ b/sklearn/metrics/tests/test_classification.py\n@@ -45,12 +45,13 @@\n from sklearn.preprocessing import LabelBinarizer, label_binarize\n from sklearn.tree import DecisionTreeClassifier\n from sklearn.utils._array_api import (\n-    device as array_api_device,\n-)\n-from sklearn.utils._array_api import (\n+    _get_namespace_device_dtype_ids,\n     get_namespace,\n     yield_namespace_device_dtype_combinations,\n )\n+from sklearn.utils._array_api import (\n+    device as array_api_device,\n+)\n from sklearn.utils._mocking import MockDataFrame\n from sklearn.utils._testing import (\n     _array_api_for_tests,\n@@ -3743,3 +3744,30 @@ def test_probabilistic_metrics_multilabel_array_api(\n         metric_score_xp = prob_metric(y_true_xp, y_prob_xp, sample_weight=sample_weight)\n \n     assert metric_score_xp == pytest.approx(metric_score_np)\n+\n+\n+@pytest.mark.parametrize(\n+    \"array_namespace, device_, dtype_name\",\n+    yield_namespace_device_dtype_combinations(),\n+    ids=_get_namespace_device_dtype_ids,\n+)\n+@pytest.mark.parametrize(\"prob_metric\", [brier_score_loss, d2_brier_score])\n+def test_pos_label_in_brier_score_metrics_array_api(\n+    prob_metric, array_namespace, device_, dtype_name\n+):\n+    \"\"\"Check `pos_label` handled correctly when labels not in {-1, 1} or {0, 1}.\"\"\"\n+    # For 'brier_score' metrics, when `pos_label=None` and labels are not strings,\n+    # `pos_label` defaults to the largest label.\n+    xp = _array_api_for_tests(array_namespace, device_)\n+    y_true_pos_1 = xp.asarray(np.array([1, 0, 1, 0]), device=device_)\n+    # Result should be the same when we use 2's for the label instead of 1's\n+    y_true_pos_2 = xp.asarray(np.array([2, 0, 2, 0]), device=device_)\n+    y_prob = xp.asarray(\n+        np.array([0.5, 0.2, 0.7, 0.6], dtype=dtype_name), device=device_\n+    )\n+\n+    with config_context(array_api_dispatch=True):\n+        metric_pos_1 = prob_metric(y_true_pos_1, y_prob)\n+        metric_pos_2 = prob_metric(y_true_pos_2, y_prob)\n+\n+    assert metric_pos_1 == pytest.approx(metric_pos_2)\n",
  "fail_to_pass": [
    "test_pos_label_in_brier_score_metrics_array_api"
  ],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/metrics/_classification.py",
    "sklearn/metrics/tests/test_classification.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-12-19T05:36:36Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/32923",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/issues/10010"
}