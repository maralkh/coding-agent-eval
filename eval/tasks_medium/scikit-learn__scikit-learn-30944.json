{
  "id": "scikit-learn__scikit-learn-30944",
  "repo": "scikit-learn/scikit-learn",
  "base_commit": "7131d9488dfb8edd6ae042caca57dd76523f395b",
  "issue_number": 30943,
  "issue_title": "MNT Add `flexibe_types` to `assert_docstring_consistency`",
  "issue_body": "#### Reference Issues/PRs\r\n\r\nFollows from https://github.com/scikit-learn/scikit-learn/pull/28678#issuecomment-2677297422\r\n\r\n#### What does this implement/fix? Explain your changes.\r\n\r\nAdds `flexibe_types`:\r\n* dictionary allowing you to specify flexible types for individual param/attr/return \r\n* allows you to specify the number of types that should be common between objects\r\n* also remove default type checking, if you wish to only use this set int to `0`\r\n\r\nAdded a very simple test case just to demonstrate its use, but no unit tests.\r\n\r\n#### Any other comments?\r\n\r\nThe addition is probably more complicated than I would like, both the parameter use and the code. I do think it does address most (all?) of the type cases we would encounter though.\r\n\r\nNot 100% and open to suggestions. Potentially a simple `ignore_type` option may be easier?\r\n\r\nNote this is a draft PR, as it is just to see if we like the addition.\r\n\r\ncc @glemaitre @adrinjalali @StefanieSenger \r\n",
  "pr_number": 30944,
  "pr_title": "MNT Add `ignore_types` to `assert_docstring_consistency`",
  "gold_patch": "diff --git a/sklearn/tests/test_docstring_parameters_consistency.py b/sklearn/tests/test_docstring_parameters_consistency.py\nindex d77f1e3c3f80f..cecc35131b4f7 100644\n--- a/sklearn/tests/test_docstring_parameters_consistency.py\n+++ b/sklearn/tests/test_docstring_parameters_consistency.py\n@@ -4,10 +4,27 @@\n import pytest\n \n from sklearn import metrics\n-from sklearn.ensemble import StackingClassifier, StackingRegressor\n+from sklearn.ensemble import (\n+    BaggingClassifier,\n+    BaggingRegressor,\n+    IsolationForest,\n+    StackingClassifier,\n+    StackingRegressor,\n+)\n from sklearn.utils._testing import assert_docstring_consistency, skip_if_no_numpydoc\n \n CLASS_DOCSTRING_CONSISTENCY_CASES = [\n+    {\n+        \"objects\": [BaggingClassifier, BaggingRegressor, IsolationForest],\n+        \"include_params\": [\"max_samples\"],\n+        \"exclude_params\": None,\n+        \"include_attrs\": False,\n+        \"exclude_attrs\": None,\n+        \"include_returns\": False,\n+        \"exclude_returns\": None,\n+        \"descr_regex_pattern\": r\"The number of samples to draw from X to train each.*\",\n+        \"ignore_types\": (\"max_samples\"),\n+    },\n     {\n         \"objects\": [StackingClassifier, StackingRegressor],\n         \"include_params\": [\"cv\", \"n_jobs\", \"passthrough\", \"verbose\"],\ndiff --git a/sklearn/utils/_testing.py b/sklearn/utils/_testing.py\nindex c1cbeb6e56582..23653f9c67f25 100644\n--- a/sklearn/utils/_testing.py\n+++ b/sklearn/utils/_testing.py\n@@ -686,12 +686,42 @@ def _get_diff_msg(docstrings_grouped):\n \n \n def _check_consistency_items(\n-    items_docs, type_or_desc, section, n_objects, descr_regex_pattern=\"\"\n+    items_docs,\n+    type_or_desc,\n+    section,\n+    n_objects,\n+    descr_regex_pattern=\"\",\n+    ignore_types=tuple(),\n ):\n     \"\"\"Helper to check docstring consistency of all `items_docs`.\n \n     If item is not present in all objects, checking is skipped and warning raised.\n     If `regex` provided, match descriptions to all descriptions.\n+\n+    Parameters\n+    ----------\n+    items_doc : dict of dict of str\n+        Dictionary where the key is the string type or description, value is\n+        a dictionary where the key is \"type description\" or \"description\"\n+        and the value is a list of object names with the same string type or\n+        description.\n+\n+    type_or_desc : {\"type description\", \"description\"}\n+        Whether to check type description or description between objects.\n+\n+    section : {\"Parameters\", \"Attributes\", \"Returns\"}\n+        Name of the section type.\n+\n+    n_objects : int\n+        Total number of objects.\n+\n+    descr_regex_pattern : str, default=\"\"\n+        Regex pattern to match for description of all objects.\n+        Ignored when `type_or_desc=\"type description\".\n+\n+    ignore_types : tuple of str, default=()\n+        Tuple of parameter/attribute/return names for which type description\n+        matching is ignored. Ignored when `type_or_desc=\"description\".\n     \"\"\"\n     skipped = []\n     for item_name, docstrings_grouped in items_docs.items():\n@@ -710,6 +740,9 @@ def _check_consistency_items(\n                     f\" does not match 'descr_regex_pattern': {descr_regex_pattern} \"\n                 )\n                 raise AssertionError(msg)\n+        # Skip type checking for items in `ignore_types`\n+        elif type_or_desc == \"type specification\" and item_name in ignore_types:\n+            continue\n         # Otherwise, if more than one key, docstrings not consistent between objects\n         elif len(docstrings_grouped.keys()) > 1:\n             msg_diff = _get_diff_msg(docstrings_grouped)\n@@ -738,6 +771,7 @@ def assert_docstring_consistency(\n     include_returns=False,\n     exclude_returns=None,\n     descr_regex_pattern=None,\n+    ignore_types=tuple(),\n ):\n     r\"\"\"Check consistency between docstring parameters/attributes/returns of objects.\n \n@@ -786,6 +820,10 @@ def assert_docstring_consistency(\n         parameters/attributes/returns. If None, will revert to default behavior\n         of comparing descriptions between objects.\n \n+    ignore_types : tuple of str, default=tuple()\n+        Tuple of parameter/attribute/return names to exclude from type description\n+        matching between objects.\n+\n     Examples\n     --------\n     >>> from sklearn.metrics import (accuracy_score, classification_report,\n@@ -849,7 +887,13 @@ def _create_args(include, exclude, arg_name, section_name):\n                     type_items[item_name][type_def].append(obj_name)\n                     desc_items[item_name][desc].append(obj_name)\n \n-        _check_consistency_items(type_items, \"type specification\", section, n_objects)\n+        _check_consistency_items(\n+            type_items,\n+            \"type specification\",\n+            section,\n+            n_objects,\n+            ignore_types=ignore_types,\n+        )\n         _check_consistency_items(\n             desc_items,\n             \"description\",\n",
  "fail_to_pass": [],
  "pass_to_pass": [],
  "relevant_files": [
    "sklearn/tests/test_docstring_parameters_consistency.py",
    "sklearn/utils/_testing.py"
  ],
  "difficulty": "medium",
  "created_at": "2025-03-05T01:06:26Z",
  "pr_url": "https://github.com/scikit-learn/scikit-learn/pull/30944",
  "issue_url": "https://github.com/scikit-learn/scikit-learn/pull/30943"
}